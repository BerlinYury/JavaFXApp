# JavaFXApp

JavaFXApp — это приложение для обмена сообщениями, состоящее из клиентской и серверной частей. Проект разработан с использованием Java, JavaFX и WebSocket для обеспечения реального времени обмена сообщениями между пользователями.

## Описание

Проект состоит из клиентской части, реализованной с использованием JavaFX для пользовательского интерфейса, и серверной части, которая управляет хранением данных и обработкой сообщений. Серверная часть взаимодействует с базой данных MySQL для хранения информации о пользователях, группах и сообщениях.

## Структура проекта

- **Server**: Серверная часть приложения, управляющая подключениями клиентов и обработкой сообщений.
- **Client**: Клиентская часть приложения, предоставляющая графический интерфейс для взаимодействия пользователей.
- **API**: Общие классы и интерфейсы, используемые как клиентом, так и сервером.

## Протокол сообщений

### MessageBox

`MessageBox` — это основная структура данных для передачи сообщений и команд между клиентом и сервером. Он содержит следующую информацию:

- `messageId`: Уникальный идентификатор сообщения.
- `messageTypeFirstLevel`: Уровень сообщения, который может быть `MESSAGE` или `COMMAND`.
- `messageTypeSecondLevel`: Уровень, указывающий направление или статус, например, `OUTGOING`, `INCOMING`, `ACCEPT`, `FAILED`.
- `messageTypeThirdLevel`: Уровень, указывающий на операцию, например, `REG`, `AUTH`, `STATUS`.
- `messageTypeFourLevel`: Уровень, указывающий на тип сущности, например, `PERSON`, `GROUP`.
- `dateTime`: Время отправки сообщения.
- `owner`, `person`, `group`, `sender`: Информация о пользователе, группе или отправителе.
- `message`: Содержимое текстового сообщения.
- `email`, `password`: Данные для аутентификации.
- `activePersonList`, `allPersonList`, `groupWhereIAmAMemberList`: Списки пользователей или групп.
- `errorOnFieldList`: Список ошибок, связанных с полями.
- `history`: Флаг, указывающий, является ли сообщение частью истории.

### Примеры использования

- **Регистрация пользователя**: Используется `COMMAND` с `REQUEST` и `REG` для регистрации нового пользователя.
- **Отправка сообщения**: Используется `MESSAGE` с `OUTGOING` для отправки сообщения другому пользователю или в группу.

## Работа с сообщениями и командами

### На сервере

Сервер обрабатывает входящие сообщения и команды через WebSocket соединение:

1. **Обработка команд**:
    - Команды, такие как регистрация (`REG`) и аутентификация (`AUTH`), обрабатываются с помощью методов `workWithReg` и `workWithAuthPerson`.
    - Сервер проверяет данные, взаимодействует с базой данных и отправляет ответ клиенту.

2. **Обработка сообщений**:
    - Сообщения обрабатываются в методе `workWithMessage`.
    - Сообщения сохраняются в базе данных и пересылаются соответствующим пользователям или группам.

3. **Управление подключениями**:
    - Сервер управляет подключениями клиентов с помощью методов `subscribe` и `unsubscribe`, обновляя список активных пользователей и их статусы.

### На клиенте

Клиент взаимодействует с сервером через WebSocket соединение и предоставляет пользовательский интерфейс для взаимодействия:

1. **Отправка сообщений**:
    - Клиент отправляет сообщения и команды серверу, используя метод `sendMessage`.
    - Сообщения создаются с помощью билдера `MessageBox.Builder`.

2. **Обработка входящих сообщений**:
    - Входящие сообщения обрабатываются методом `addIncomingMessage`, который обновляет интерфейс пользователя новым содержимым.

3. **Создание чатов и групп**:
    - Клиент предоставляет интерфейс для создания новых чатов и групп, отправляя соответствующие команды на сервер.

## Установка

### Требования

- Java 17 или выше
- MySQL сервер